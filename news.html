<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>–ö—Ä–∏–ø—Ç–æ –Ω–æ–≤–æ—Å—Ç–∏ (RSS –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä)</title>
  <link rel="stylesheet" href="style.css">
  <style>
    main { margin-left: 250px; margin-top: 64px; padding: 20px; }
    h1 { text-align: center; margin-bottom: 18px; }

    /* –ö–æ–Ω—Ç—Ä–æ–ª—ã */
    .controls {
      max-width: 980px;
      margin: 0 auto 16px auto;
    }
    .sources {
      text-align: center;
      font-size: 14px;
      color: #666;
      margin-bottom: 8px;
    }
    .refresh-container {
      text-align: right;
    }
    #refreshBtn {
      background-color: #000;
      color: #fff;
      font-size: 18px;
      font-weight: 500;
      padding: 12px 24px;
      border: none;
      border-radius: 12px;
      cursor: pointer;
      transition: background-color 0.2s;
    }
    #refreshBtn:hover { background-color: #222; }

    /* –ù–æ–≤–æ—Å—Ç–∏ */
    .news-list {
      max-width: 980px;
      margin: 0 auto;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    .news-item {
      background: #fff;
      border-radius: 12px;
      padding: 18px;
      box-shadow: 0 3px 8px rgba(0,0,0,0.1);
    }
    .news-item h3 { margin: 0 0 8px 0; font-size: 18px; }
    .news-item a { color: #007bff; text-decoration: none; }
    .news-item a:hover { text-decoration: underline; }
    .meta { font-size: 13px; color: #666; margin-bottom: 6px; }
    .summary { color: #333; font-size: 17px; line-height: 1.6; }
    .loading { text-align:center; padding:30px; color:#444; }
  </style>
</head>
<body>
  <div id="header"></div>
  <div id="sidebar"></div>

  <main>
    <h1>üì∞ –ê–≥–≥—Ä–µ–≥–∞—Ç–æ—Ä –∫—Ä–∏–ø—Ç–æ‚Äë–Ω–æ–≤–æ—Å—Ç–µ–π (RSS)</h1>

      <div class="controls">
      <div class="sources">–ò—Å—Ç–æ—á–Ω–∏–∫–∏: CoinDesk, CoinTelegraph, Decrypt, CryptoSlate, TheBlock –∏ –¥—Ä.</div>
      <div class="refresh-container"><button id="refreshBtn">–û–±–Ω–æ–≤–∏—Ç—å</button></div>
    </div>

    –°–≤–µ–∂–∏–µ –Ω–æ–≤–æ—Å—Ç–∏ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç –∏ —Ç—Ä–µ–π–¥–∏–Ω–≥–∞ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ —Å –∫—Ä—É–ø–Ω–µ–π—à–∏—Ö –æ–∫–æ–ª–æ –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç–Ω—ã—Ö —Å–∞–π—Ç–æ–≤ –Ω–∞ –æ–¥–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ. –ü–æ–¥–æ–∂–¥–∏—Ç–µ –Ω–µ—Å–∫–æ–ª—å–∫–æ —Å–µ–∫—É–Ω–¥ –∑–∞–≥—Ä—É–∑–∫—É –∫—Ä–∏–ø—Ç–æ –Ω–æ–≤–æ—Å—Ç–µ–π.

    <div id="news-container" class="news-list">
      <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...</div>
    </div>
<div style="text-align:center; margin:32px 0;">
  <a href="https://www.binance.com/ru?ref=SITES" target="_blank" rel="noopener noreferrer">
    <img src="binance.jpg" alt="Binance" width="1200" height="675" style="border:0; display:inline-block;">
  </a>
</div>

  </main>

  <script>
    // –ü–æ–¥–≥—Ä—É–∂–∞–µ–º header –∏ sidebar
    fetch('header.html').then(r => r.text()).then(t => document.getElementById('header').innerHTML = t);
    fetch('sidebar.html').then(r => r.text()).then(t => document.getElementById('sidebar').innerHTML = t);

    const newsContainer = document.getElementById('news-container');
    const refreshBtn = document.getElementById('refreshBtn');

    const feeds = [
      'https://www.coindesk.com/arc/outboundfeeds/rss/',
      'https://cointelegraph.com/rss',
      'https://decrypt.co/feed',
      'https://cryptoslate.com/feed/',
      'https://www.theblock.co/feed',
      'https://www.coingecko.com/en/rss',
      'https://news.bitcoin.com/feed/'
    ];

    function proxyUrl(url) { return 'https://api.allorigins.win/raw?url=' + encodeURIComponent(url); }

    async function fetchAndParse(feedUrl) {
      try {
        const res = await fetch(proxyUrl(feedUrl));
        if (!res.ok) throw new Error('fetch failed ' + res.status);
        const text = await res.text();
        const doc = new DOMParser().parseFromString(text, 'application/xml');

        let source = '';
        const chTitle = doc.querySelector('channel > title') || doc.querySelector('feed > title');
        if (chTitle) source = chTitle.textContent.trim();

        const items = Array.from(doc.querySelectorAll('item, entry')).slice(0, 50);
        return items.map(it => {
          const tEl = it.querySelector('title');
          const title = tEl ? tEl.textContent.trim() : '(–±–µ–∑ –∑–∞–≥–æ–ª–æ–≤–∫–∞)';

          let link = '';
          const linkEl = it.querySelector('link');
          if (linkEl) link = linkEl.getAttribute('href') || linkEl.textContent || '';
          if (!link) {
            const guid = it.querySelector('guid');
            if (guid) link = guid.textContent || '';
          }

          const dateEl = it.querySelector('pubDate, published, updated, dc\\:date');
          const pubDate = dateEl ? new Date(dateEl.textContent) : null;

          const descEl = it.querySelector('description, summary, content');
          const summary = descEl ? descEl.textContent.trim() : '';

          return { title, link, pubDate, source: source || feedUrl, summary };
        });
      } catch (e) {
        console.warn('feed error', feedUrl, e);
        return [];
      }
    }

    // --- –î–ª—è –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ–π –ø—Ä–æ–∫—Ä—É—Ç–∫–∏ ---
    let allNews = [];
    let newsIndex = 0;
    const NEWS_BATCH = 10;

    function renderNewsBatch() {
      if(newsIndex >= allNews.length) return;
      const batch = allNews.slice(newsIndex, newsIndex + NEWS_BATCH);
      newsIndex += NEWS_BATCH;
      newsContainer.innerHTML += batch.map(it=>{
        const dateText = it.pubDate && it.pubDate.getTime()>0 ? '| ' + it.pubDate.toLocaleString('ru-RU') : '';
        const summaryShort = it.summary ? '<div class="summary">'+escapeHtml(truncate(stripTags(it.summary),280))+'</div>' : '';
        return `<div class="news-item">
          <div class="meta">${escapeHtml(it.source)} ${dateText}</div>
          <h3><a href="${escapeHtmlAttr(it.link)}" target="_blank" rel="noopener noreferrer">${escapeHtml(it.title)}</a></h3>
          ${summaryShort}
        </div>`;
      }).join('');
    }

    async function loadAllNews() {
      newsContainer.innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π...</div>';
      try {
        const arrays = await Promise.all(feeds.map(f => fetchAndParse(f)));
        let all = arrays.flat();
        all = all.filter(it => it.title && it.link);

        const unique = [];
        const urls = new Set();
        for (const it of all) {
          if (!urls.has(it.link)) {
            urls.add(it.link);
            unique.push(it);
          }
        }

        unique.forEach(it => { if (!it.pubDate || isNaN(it.pubDate)) it.pubDate = new Date(0); });
        unique.sort((a,b)=>b.pubDate-a.pubDate);

        if(unique.length===0){newsContainer.innerHTML='<div class="loading">–ù–æ–≤–æ—Å—Ç–µ–π –Ω–µ –Ω–∞–π–¥–µ–Ω–æ üòî</div>'; return;}

        allNews = unique;  // —Å–æ—Ö—Ä–∞–Ω–∏–º –≤—Å–µ –Ω–æ–≤–æ—Å—Ç–∏
        newsContainer.innerHTML = ''; // –æ—á–∏—Å—Ç–∏–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        newsIndex = 0;
        renderNewsBatch();
      } catch(e){console.error(e); newsContainer.innerHTML='<div class="loading">–ù–µ —É–¥–∞–ª–æ—Å—å –∑–∞–≥—Ä—É–∑–∏—Ç—å –Ω–æ–≤–æ—Å—Ç–∏ üòî</div>';}
    }

    // –£—Ç–∏–ª–∏—Ç—ã
    function stripTags(html){return html.replace(/<\/?[^>]+(>|$)/g," ");}
    function truncate(str,n){return str.length>n?str.slice(0,n-1)+'‚Ä¶':str;}
    function escapeHtml(s){return (s||'').replace(/[&<>"']/g,m=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]));}
    function escapeHtmlAttr(s){return escapeHtml(s).replace(/"/g,'&quot;');}

    refreshBtn.addEventListener('click',()=>{loadAllNews();});

    // –ü–æ–¥–≥—Ä—É–∑–∫–∞ –ø–æ —Å–∫—Ä–æ–ª–ª—É
    window.addEventListener('scroll', ()=>{
      if((window.innerHeight + window.scrollY) >= document.body.offsetHeight - 200) {
        renderNewsBatch();
      }
    });

    // –ì—Ä—É–∑–∏–º –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
    loadAllNews();
  </script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-KH63Z4DFJ2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-KH63Z4DFJ2');
</script>

</body>
</html>
