<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–†—ã–Ω–æ–∫ Binance ‚Äî –§—å—é—á–µ—Ä—Å—ã (USDT-M)</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      background: #fafafa;
      font-family: Arial, sans-serif;
      color: #111;
    }

    main {
      padding: 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    .market-container {
      background: #fff;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    }

    table {
      width: 100%;
      border-collapse: collapse;
    }

    thead {
      background: #f1f1f1;
      cursor: pointer;
    }

    th, td {
      padding: 12px;
      text-align: left;
      font-size: 14px;
    }

    tbody tr:nth-child(even) {
      background: #f9f9f9;
    }

    .green {
      color: #16a34a;
      font-weight: bold;
    }

    .red {
      color: #dc2626;
      font-weight: bold;
    }

    .trade-btn {
      background: #fcd535;
      color: #000;
      padding: 6px 10px;
      border-radius: 4px;
      text-decoration: none;
      font-weight: 600;
    }

    .trade-btn:hover {
      background: #e0bb2f;
    }

    th.sortable:hover {
      background: #e9e9e9;
    }

    th.active-sort {
      background: #e0e0e0;
    }

    h1 {
      text-align: center;
      margin-bottom: 20px;
    }

    .coin-icon {
      width: 20px;
      height: 20px;
      margin-right: 6px;
      vertical-align: middle;
      border-radius: 50%;
    }
  </style>
</head>
<body>
  <div id="header"></div>
  <div id="sidebar"></div>

  <main>
    <h1>üìä –†—ã–Ω–æ–∫ Binance ‚Äî –§—å—é—á–µ—Ä—Å—ã (USDT-M)</h1>
    <div class="market-container">
      <table>
        <thead>
          <tr>
            <th>–ü–∞—Ä–∞</th>
            <th class="sortable" data-sort="price">–¶–µ–Ω–∞ ‚ñ≤‚ñº</th>
            <th class="sortable" data-sort="change">–ò–∑–º. 24—á ‚ñ≤‚ñº</th>
            <th class="sortable" data-sort="volume">–û–±—ä—ë–º ‚ñ≤‚ñº</th>
            <th>–¢–æ—Ä–≥–æ–≤–∞—Ç—å</th>
          </tr>
        </thead>
        <tbody id="market-body">
          <tr><td colspan="5" style="text-align:center;padding:20px;">–ó–∞–≥—Ä—É–∑–∫–∞...</td></tr>
        </tbody>
      </table>
    </div>
  </main>

  <script>
    // –ó–∞–≥—Ä—É–∂–∞–µ–º header –∏ sidebar (–∏–≥–Ω–æ—Ä–∏—Ä—É–µ–º –æ—à–∏–±–∫–∏ –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ)
    fetch('header.html')
      .then(res => {
        if (!res.ok) throw new Error('Header not found');
        return res.text();
      })
      .then(data => document.getElementById('header').innerHTML = data)
      .catch(() => console.warn('‚ö† Header –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫).'));

    fetch('sidebar.html')
      .then(res => {
        if (!res.ok) throw new Error('Sidebar not found');
        return res.text();
      })
      .then(data => document.getElementById('sidebar').innerHTML = data)
      .catch(() => console.warn('‚ö† Sidebar –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω (–ª–æ–∫–∞–ª—å–Ω—ã–π –∑–∞–ø—É—Å–∫).'));

    const API_URL = 'https://api.coingecko.com/api/v3/derivatives';
    const REF_ID = 'SITES'; // —Ç–≤–æ–π —Ä–µ—Ñ–µ—Ä–∞–ª—å–Ω—ã–π ID
    let marketData = [];
    let currentSort = { key: 'volume', asc: false };

    async function loadMarketData() {
      try {
        const response = await fetch(API_URL);
        const data = await response.json();

        // –û—Ç–±–∏—Ä–∞–µ–º —Ç–æ–ª—å–∫–æ Binance Futures USDT –ø–∞—Ä—ã
        marketData = data
          .filter(item =>
            item.market === 'Binance (Futures)' &&
            item.symbol &&
            item.symbol.toUpperCase().endsWith('USDT') &&
            item.base
          )
          .map(item => ({
            symbol: item.base ? item.base.toUpperCase() : '‚Äî',
            price: item.last_price ?? 0,
            change: item.price_percentage_change_24h ?? 0,
            volume: item.converted_volume?.usd ?? 0,
            image: item.base ? `https://coinicons-api.vercel.app/api/icon/${item.base.toLowerCase()}` : ''
          }));

        renderTable();
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö CoinGecko Futures:', e);
        const tbody = document.getElementById('market-body');
        tbody.innerHTML = `<tr><td colspan="5" style="text-align:center;padding:20px;">‚ö† –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö</td></tr>`;
      }
    }

    function renderTable() {
      const tbody = document.getElementById('market-body');
      tbody.innerHTML = '';

      const sorted = [...marketData].sort((a, b) => {
        const key = currentSort.key;
        const dir = currentSort.asc ? 1 : -1;
        return a[key] > b[key] ? dir : a[key] < b[key] ? -dir : 0;
      });

      sorted.forEach(item => {
        const changeClass = item.change >= 0 ? 'green' : 'red';
        const tradeUrl = `https://www.binance.com/ru/futures/${item.symbol}USDT?ref=${REF_ID}`;

        const row = `
          <tr>
            <td><img src="${item.image}" alt="" class="coin-icon">${item.symbol}/USDT</td>
            <td>${item.price.toFixed(6)}</td>
            <td class="${changeClass}">${item.change.toFixed(2)}%</td>
            <td>${Number(item.volume).toLocaleString()}</td>
            <td><a class="trade-btn" href="${tradeUrl}" target="_blank">–¢–æ—Ä–≥–æ–≤–∞—Ç—å</a></td>
          </tr>
        `;
        tbody.insertAdjacentHTML('beforeend', row);
      });

      updateActiveSortHeader();
    }

    function updateActiveSortHeader() {
      document.querySelectorAll('th.sortable').forEach(th => {
        th.classList.remove('active-sort');
        if (th.dataset.sort === currentSort.key) {
          th.classList.add('active-sort');
        }
      });
    }

    document.querySelectorAll('th.sortable').forEach(th => {
      th.addEventListener('click', () => {
        const sortKey = th.dataset.sort;
        if (currentSort.key === sortKey) {
          currentSort.asc = !currentSort.asc;
        } else {
          currentSort.key = sortKey;
          currentSort.asc = false;
        }
        renderTable();
      });
    });

    loadMarketData();
    setInterval(loadMarketData, 30000);
  </script>

  <!-- Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-EEZSLT2L6C"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-KH63Z4DFJ2');
  </script>
</body>
</html>
